#= depend_on_asset "list-of-events.html"
#= depend_on_asset "show-selected-event.html"
#= depend_on_asset "list-of-members.html"
#= depend_on_asset "list-of-payments.html"
#= depend_on_asset "payments-chart.html"

(function() { 
  'use strict';
  var app = angular.module('weOWhatApp', ['chartjs']); 
  app.controller('EventController', ["$scope", "$http", function($scope, $http) {

    $scope.events = [];
    $scope.newEvent = false;

    $http.get("/events.json").success(function(data){
      $scope.events = data;
    })

    $scope.selectEvent = function(event){
      $scope.selectedEvent = event;
      
      $http.get("/event_users/"+ event.id +".json").success(function(data){
        $scope.members = data;
      })

      $http.get("/event_payments/"+ event.id +".json").success(function(data){
        $scope.payments = data;
        var payments_made = 0;

          for( var i = 0 ; i < $scope.payments.length; i++) {
            var users = [];
            $scope.members.filter(function(value, index, ar) {
              if(value.id == $scope.payments[i].user_id) {
                users.push($scope.members[index]) 
              } 
            })
            $scope.payments[i].users = users

            payments_made += $scope.payments[i].amount
          }
          $scope.payments_total = payments_made;
        })

      $http.get("/event_payments_by_user/"+ event.id +".json").success(function(data){
          $scope.someData = data;
      })
    }

    $scope.someOptions = {
      segementStrokeWidth: 20,
      percentageInnerCutout: 50,
      animateRotate: true
    };

    $scope.clearSelectedEvent = function(){
      $scope.selectedEvent = false;
    }
  //   $scope.modalShown = false;
  //     $scope.toggleModal = function() {
  //       $scope.modalShown = !$scope.modalShown;
  //     };
  // }]);

app.directive('listOfEvents', function() { 
  return { 
    restrict: 'C', 
    templateUrl: "<%= asset_path('list-of-events.html') %>"
  } 
})
app.directive('showSelectedEvent', function() { 
  return { 
    restrict: 'C', 
    templateUrl: "<%= asset_path('show-selected-event.html') %>"
  } 
}) 
app.directive('listOfMembers', function() { 
  return { 
    restrict: 'C', 
    templateUrl: "<%= asset_path('list-of-members.html') %>"
  } 
}) 

app.directive('listOfPayments', function() { 
  return { 
    restrict: 'C', 
    templateUrl: "<%= asset_path('list-of-payments.html') %>"
  } 
}) 

app.directive('paymentsChart', function() { 
  return { 
    restrict: 'C', 
    templateUrl: "<%= asset_path('payments-chart.html') %>"
  } 
}) 
// app.directive('modalDialog', function() {
//   return {
//     restrict: 'E',
//     scope: {
//       show: '='
//     },
//     replace: true, // Replace with the template below
//     transclude: true, // we want to insert custom content inside the directive
//     link: function(scope, element, attrs) {
//       scope.dialogStyle = {};
//       if (attrs.width)
//         scope.dialogStyle.width = attrs.width;
//       if (attrs.height)
//         scope.dialogStyle.height = attrs.height;
//       scope.hideModal = function() {
//         scope.show = false;
//       };
//     },
//     template: '...' // See below
//   };
// });
})();
