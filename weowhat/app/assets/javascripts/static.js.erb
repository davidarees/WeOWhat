#= depend_on_asset "list-of-events.html"
#= depend_on_asset "show-selected-event.html"
#= depend_on_asset "list-of-members.html"
#= depend_on_asset "list-of-members.html"

(function() { 
  var app = angular.module('weOWhatApp', []); 
  app.controller('EventController', ["$scope", "$http", function($scope, $http) {

    $scope.events = [];
    $scope.newEvent = false;

    $http.get("/events.json").success(function(data){
      $scope.events = data;
    })

    $scope.selectEvent = function(event){
      $scope.selectedEvent = event;
      
      $http.get("/event_users/"+ event.id +".json").success(function(data){
        $scope.members = data;
        console.log(data)
      })

      $http.get("/event_payments/"+ event.id +".json").success(function(data){
          $scope.payments = data;
          
          for( var i = 0 ; i < $scope.payments.length; i++) {
            var users = []
            $scope.members.filter(function(value, index, ar) {
              if(value.id == $scope.payments[i].user_id) {
                users.push($scope.members[index]) 
              } 
            })
            $scope.payments[i].users = users
          }

      })

    }

    $scope.clearSelectedEvent = function(){
      $scope.selectedEvent = false;
    }

    $scope.findUser = function(id) {
      // console.log($scope.members)
        
    }

  }])

  app.directive('listOfEvents', function() { 
    return { 
      restrict: 'C', 
      templateUrl: "<%= asset_path('list-of-events.html') %>"
    } 
  })
  app.directive('showSelectedEvent', function() { 
    return { 
      restrict: 'C', 
      templateUrl: "<%= asset_path('show-selected-event.html') %>"
    } 
  }) 
  app.directive('listOfMembers', function() { 
    return { 
      restrict: 'C', 
      templateUrl: "<%= asset_path('list-of-members.html') %>"
    } 
  }) 

  app.directive('listOfPayments', function() { 
    return { 
      restrict: 'C', 
      templateUrl: "<%= asset_path('list-of-payments.html') %>"
    } 
  }) 
})();
